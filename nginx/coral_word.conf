# Nginx 反向代理：coral_word 项目
# 将 80 端口流量转发到 Go Gin 服务（默认 8080）
# 使用前请确保：1) 本机已安装 nginx  2) Go 服务已启动且监听 HTTP_ADDR（如 0.0.0.0:8080）

server {
    listen 80;
    listen [::]:80;
    server_name _;
    #去掉等号，不需要精确匹配
    root /home/qzr/gitee/chat-server-cpp/web;
    index index.html chat.html;
    location / {
        try_files $uri $uri/ /chat.html;
    }
    # 可选：单独给 chat 一个路径
    location = /chat.html {
        alias /home/qzr/gitee/chat-server-cpp/web/chat.html;
    }
    location  /chat{
        proxy_pass http://127.0.0.1:9000;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
    #去掉等号，不需要精确匹配
    location  /coral{
        proxy_pass http://127.0.0.1:10101;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
    # ---------- 特定接口走特定路由：按 path 分流 ----------
    # 规则：更具体的 location 写在上面，前缀匹配按最长优先；正则用 ~ 或 ~*。
    # 示例 1：只把 /word 查词接口转发到 8080，其它走 10101
    # location = /word {
    #     proxy_pass http://127.0.0.1:8080;
    #     proxy_set_header Host $host;
    #     proxy_set_header X-Real-IP $remote_addr;
    #     proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    #     proxy_set_header X-Forwarded-Proto $scheme;
    # }
    # 示例 2：/api/ 前缀全部转发到另一个服务（如 9090）
    # location /api/ {
    #     proxy_pass http://127.0.0.1:9090;
    #     proxy_set_header Host $host;
    #     proxy_set_header X-Real-IP $remote_addr;
    #     proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    #     proxy_set_header X-Forwarded-Proto $scheme;
    # }
    # 示例 3：静态文件由 Nginx 直接提供（需改 CORAL_WORD_ROOT 为项目根路径）
    # location /static/ {
    #     alias /path/to/coral_word/web/static/;
    # }

    # 默认：其余请求转发到 Gin（与上面示例二选一，不要重复匹配同一 path）
    # location / {
    #     proxy_pass http://127.0.0.1:10101;
    #     proxy_http_version 1.1;
    #     proxy_set_header Host $host;
    #     proxy_set_header X-Real-IP $remote_addr;
    #     proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    #     proxy_set_header X-Forwarded-Proto $scheme;
    # }
}


# Header	含义
# User-Agent	发起请求的客户端标识。Apifox/1.0.0 表示请求来自 Apifox（API 调试工具），类似浏览器会发 Mozilla/5.0 ...。
# Accept	客户端能接受的响应内容类型。*/* 表示接受任意类型（如 JSON、HTML 等）。
# Accept-Encoding	客户端支持的响应压缩方式。gzip, deflate, br 表示支持 gzip、deflate、Brotli，服务端可任选一种压缩响应体。
# X-Real-Ip	由 Nginx（或其它反向代理）添加，表示“真实客户端”的 IP。这里 42.88.61.28 就是调用方的公网 IP；没有代理时不会出现。
# X-Forwarded-For	由代理链逐级添加，记录从客户端到当前代理的 IP 列表。这里只有 42.88.61.28，表示请求只经过一层代理（如 Nginx）。多级代理时会是 客户端IP, 代理1, 代理2。
# X-Forwarded-Proto	由代理添加，表示客户端访问代理时用的协议。http 表示用户用的是 HTTP；若前面有 HTTPS 卸载，这里会是 https，后端据此判断是否要重定向到 HTTPS 或生成 https 链接。
# Connection: close	表示本请求结束后关闭 TCP 连接，不复用（非 Keep-Alive）。代理或客户端都可能发送。